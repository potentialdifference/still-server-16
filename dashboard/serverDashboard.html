<html>
<head>
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.2.0.js"></script>
	
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore.js"></script>
	
	
	
	<style>
		.button{
			border: 1px solid;
			padding: 10px;
			margin:10px;
			background-color: yellow;
		}
</style>
</head>
<body>
<h1>Hello, welcome to app streaming test page</h1>
<p>Select what you would like to do<p>
<div id="streamFromTo" class="button">
Start stream from: <select id="streamFromClient" class="clientList"></select>
to:  <select id="streamToClient" class="clientList"/></select>
width: <input value="800" type="text" id="streamWidth"/>
height: <input value="400" type="text" id="streamHeight"/>
<button> go</button>
</div>

<div id="streamVideoFromServer" class="button">
Show video <input type="file" id="videoToShow"></input>
on: <select id="showVideoClient" class="clientList"></select>
<button> go</button>
</div>

<div id="stopStream" class="button">
Stop streaming: <select id="stopClient" class="clientList"></select>
<button> go</button>
</div>

<div id="showImage" class="button">
Show image <input type="file" id="imageToShow"></input>
on: <select id="showImageClient" class="clientList"></select>
<button> go</button>
</div>

<div id="hideImage" class="button">
Hide image 
on: <select id="hideImageClient" class="clientList"></select>
<button> go</button>
</div>

<div id="openWebPage" class="button">
Open webpage<input type="file" id="webpage"></input>
on: <select id="openWebpageClient" class="clientList"></select>
<button> go</button>
</div>





</div>

<script type="text/javascript">

var localIp = "192.168.0.4";
	var clients = {
		"Lenovo tablet" : {"name" : "lenovo", "url" : "http://192.168.0.5:8085"}, 
		"Samsung phone": {"name" : "samsung-phone", "url" : "http://192.168.0.14:8085"},
		"Samsung tablet": {"name" : "samsung-tablet", "url" : "http://192.168.0.19:8085"},
		"HTC one": {"name" : "htc-one", "url" : "http://192.168.0.20:8085"},
		"phones" : {"name" : "phones"},
		"Tablets" : {"name" : "tablets"},
		"All" : {"name" : "all"}
		};
	
	
	var makeAjaxRequest = function(url){
	
	return $.ajax({
		  url: url,
		  method: "PUT",
		  beforeSend: function(xhr){		      
				xhr.setRequestHeader('Authorization', "x9RHJ2I6nWi376Wa");      
					alert("sending "+url);
		  },
		});
	}
	
	var sendStreamVideoFromTo = function(from, to, width, height){
		var startStreamUrl = "https://localhost:8080/broadcast/"+from+"/startCameraStream?width="+width+"&height="+height;
		var streamUrl = _.find(clients, function(client){return client.name===from}).url;
		var viewStreamUrl = "https://localhost:8080/broadcast/"+to+"/streamVideo?url="+streamUrl+"&width="+width+"&height="+height;
		//$.when(makeAjaxRequest(startStreamUrl)).then(makeAjaxRequest(viewStreamUrl));
		makeAjaxRequest(startStreamUrl);
		setTimeout(function(){makeAjaxRequest(viewStreamUrl)}, 1500);
	
	}
	var sendStreamVideoFromServer = function(video, to){
		var videoUrl = "http://"+localIp+":8089/videos/"+video;
		var viewStreamUrl = "https://localhost:8080/broadcast/"+to+"/streamVideo?format=mp4&url="+videoUrl;
		makeAjaxRequest(viewStreamUrl);
	
	}
	
	var sendShowImageTo = function(imagePath, to){
		var showImageUrl = "https://localhost:8080/broadcast/"+to+"/displayImage?image="+imagePath;
		makeAjaxRequest(showImageUrl);
	}
	var sendHideImageTo = function(to){
		var hideImageUrl = "https://localhost:8080/broadcast/"+to+"/hideImage";
		makeAjaxRequest(hideImageUrl);
	}
	
	var stopStreaming = function(client){
		var stopUrl = "https://localhost:8080/broadcast/"+client+"/stop";
		makeAjaxRequest(stopUrl);
	}
	
	var sendOpenWebpage = function(page, to){
		var pageUrl = "http://"+localIp+":8089/pages/"+page;
		var viewWebPageUrl = "https://localhost:8080/broadcast/"+to+"/openWebPage?url="+pageUrl;
		makeAjaxRequest(viewWebPageUrl);
	
	}
	
	$("#streamFromTo button").click(function(){
		var from = $('#streamFromClient').val();
		var to =  $('#streamToClient').val();
		var width = $('#streamWidth').val();
		var height = $('#streamHeight').val();
		sendStreamVideoFromTo(from, to, width, height);
	});
	
	$("#streamVideoFromServer button").click(function(){
		var video = $('#videoToShow').val();
		var to =  $('#showVideoClient').val();		
		sendStreamVideoFromServer(video, to);
	});
	
	$("#stopStream button").click(function(){
		var client = $('#stopClient').val();
		stopStreaming(client);
		
	});
	
	$("#showImage button").click(function(){
		var image = $('#imageToShow').val();
		var to =  $('#showImageClient').val();
		sendShowImageTo(image, to);
	});
	
	$("#hideImage button").click(function(){
		
		var to =  $('#hideImageClient').val();
		sendHideImageTo(to);
	});
	
	$("#openWebPage button").click(function(){
		var page = $('#webpage').val();
		var to =  $('#openWebpageClient').val();		
		sendOpenWebpage(page, to);
	});
	
	//bind client lists:
	var clientOptionsHtml = '';
	_.each(clients, function(client, key){
		clientOptionsHtml += '<option value="'+client.name+'">'+key+'</option>';
	});
	var clientDropdowns = $(".clientList");
	clientDropdowns.append(clientOptionsHtml);
	
	
	
	</script>

</body>
</html>