<html>
<head>
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.2.0.js"></script>
	
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore.js"></script>
	
	
	
	<style>
		.button{
			border: 1px solid;
			padding: 10px;
			margin:10px;
			background-color: yellow;
		}
</style>
</head>
<body>
<h1>Hello, welcome to app streaming test page</h1>
<p>Select what you would like to do<p>
<div id="streamFromTo" class="button">
Start stream from: <select id="streamFromClient" class="clientList"></select>
to:  <select id="streamToClient" class="clientList"/></select>
width: <input value="800" type="text" id="streamWidth"/>
height: <input value="400" type="text" id="streamHeight"/>
<button> go</button>
</div>

<div id="showImage" class="button">
Show image <select id="images"></select>
on: <select id="showImageClient" class="clientList"></select>
<button> go</button>
</div>

<div id="showText" class="button">
Show text <input type="text" id="textToShow"/>
on: <select id="showImageClient" class="clientList"></select>
<button> go</button>
</div>


<div id="stopStream" class="button">
Stop streaming: <select id="stopClient" class="clientList"></select>
<button> go</button>
</div>


<div id="showText" class="button">
Play video <select id="videos"></select>
on: <select id="playVideoClient" class="clientList"></select>
<button> go</button>
</div>

<script type="text/javascript">
	var clients = {
		"Lenovo tablet" : {"name" : "lenovo", "url" : "http://192.168.0.5:8085"}, 
		"Samsung phone": {"name" : "samsung", "url" : "http://192.168.0.14:8085"},
		"Both" : {"name" : "russells-devices"}
		};
	var imagePaths = ["image1.jpg", "image2.jpg"];
	
	var makeAjaxRequest = function(url){
	
	return $.ajax({
		  url: url,
		  method: "PUT",
		  beforeSend: function(xhr){		      
				xhr.setRequestHeader('Authorization', "x9RHJ2I6nWi376Wa");      
					alert("sending "+url);
		  },
		});
	}
	
	var sendStreamVideoFromTo = function(from, to, width, height){
		var startStreamUrl = "https://localhost:8080/broadcast/"+from+"/startCameraStream?width="+width+"&height="+height;
		var streamUrl = _.find(clients, function(client){return client.name===from}).url;
		var viewStreamUrl = "https://localhost:8080/broadcast/"+to+"/streamVideo?url="+streamUrl+"&width="+width+"&height="+height;
		$.when(makeAjaxRequest(startStreamUrl)).then(makeAjaxRequest(viewStreamUrl));
		//makeAjaxRequest(startStreamUrl).resolve();
		/*$.ajax({
		  url: startStreamUrl,
		  method: "PUT",
		  beforeSend: function(xhr){		      
				xhr.setRequestHeader('Authorization', "x9RHJ2I6nWi376Wa");      				  
		  },
		})  .done(function( data ) {
			
		}).fail(function(error){
		alert(JSON.stringify(error));});*/
	}
	
	var sendShowImageTo = function(imagePath, to){
		var showImageUrl = "https://localhost:8080/broadcast/"+to+"/displayImage?image="+imagePath;
		makeAjaxRequest(showImageUrl);
	}
	
	$("#streamFromTo button").click(function(){
		var from = $('#streamFromClient').val();
		var to =  $('#streamToClient').val();
		var width = $('#streamWidth').val();
		var height = $('#streamHeight').val();
		sendStreamVideoFromTo(from, to, width, height);
	});
	
	$("#stopStream button").click(function(){
		alert("not yet implemented");
	});
	
	$("#showImage button").click(function(){
		var image = $('#images').val();
		var to =  $('#showImageClient').val();
		sendShowImageTo(image, to);
	});
	
	//bind client lists:
	var clientOptionsHtml = '';
	_.each(clients, function(client, key){
		clientOptionsHtml += '<option value="'+client.name+'">'+key+'</option>';
	});
	var clientDropdowns = $(".clientList");
	clientDropdowns.append(clientOptionsHtml);
	
	//bind image paths:
	var imageOptionsHtml = '';
	_.each(imagePaths, function(image, key){
		imageOptionsHtml += '<option value="'+image+'">'+image+'</option>';
	});
	$("#images").append(clientOptionsHtml);	
	</script>

</body>
</html>